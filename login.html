<!doctype html>
<html lang="pl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="src/img/icon.PNG">

    <title>Hotel Reservation System</title>

    <!-- Bootstrap core CSS -->
    <link href="dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="src/css/carousel.css" rel="stylesheet">
    <link href="src/css/main.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="dist/js/bootstrap.min.js"></script>

</head>

<body>
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4 class="modal-title w-100 font-weight-bold">Admin Panel</h4>
            </div>
            <div class="modal-body mx-3">
                <div class="md-form mb-5">
                    <i class="fas fa-envelope prefix grey-text"></i>
                    <input type="email" id="defaultForm-email" class="form-control validate">
                    <label data-error="wrong" data-success="right" for="defaultForm-email">Login: </label>
                </div>

                <div class="md-form mb-4">
                    <i class="fas fa-lock prefix grey-text"></i>
                    <input type="password" id="defaultForm-pass" class="form-control validate">
                    <label data-error="wrong" data-success="right" for="defaultForm-pass">Has≈Ço: </label>
                </div>

            </div>
            <div class="modal-footer d-flex justify-content-center">
                <button class="btn btn-default" id="lgn-btn">Login</button>
            </div>
        </div>
    </div>

    <script>
        var directory = window.location.pathname.split('/').slice(0, -1).join('/');

        // LOGIN BUTTON
        $(document).on('click', '#lgn-btn', function () {

            var myObj = {
                "login": $('#defaultForm-email').val(),
                "password": $('#defaultForm-pass').val()
            };

            var credentials = JSON.stringify(myObj)

            $.ajax({
                type: 'POST',
                url: 'http://localhost:8080/login',
                data: credentials,
                contentType: "application/json",
                dataType: "json",
                success: function (data) {
                    sessionStorage.setItem("token", JSON.stringify(data));
                    const token = JSON.parse(sessionStorage.getItem("token"));

                    $.ajax({
                        type: 'GET',
                        url: 'http://localhost:8080/reservations',
                        dataType: "json",
                        headers: { "Authorization": "Bearer " + token.token },
                        success: function (data) {
                            sessionStorage.setItem("reservations", JSON.stringify(data));
                            window.location.href = directory.concat("/admin.html");
                        },
                        error: function () {
                        alert('Failed to fetch reservations');
                    }
                    });
                },
                error: function () {
                    alert('Logowanie nieudane');
                }
            });
        });
    </script>
</body>

</html>